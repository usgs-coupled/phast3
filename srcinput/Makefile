# 
# Make file for PHASTINPUT
#
PROGRAM=phastinput

#.SILENT:

# Linux
#CC=gcc
CC=g++
#CCFLAGS=-O2 -Wall -ansi -pedantic 
CCFLAGS=-g -Wall -ansi -pedantic 

# RS6000
#CC=cc
#CCFLAGS=-langlvl=ansi -O2

# Dec Alpha
#CC=cc
#CCFLAGS=-ansi -O2

#Solaris
#CC=/opt/SUNWspro/bin/cc
#CCFLAGS=-fast

LOADFLAGS= -lm 
LOADFLAGS+=$(call ld-option, -Wl$(comma)--hash-style=sysv)
#LOADFLAGS+= -lefence

FILES=\
	main.c		accumulate.c 	check.c 	gpc.c 		message.c\
	read.c		rivers.c 	structures.c	utilities.c	wells.c \
	write.c		Makefile	unit_impl.cxx units_impl.cxx

OBJECTS=\
	main.o 		accumulate.o 	check.o 	gpc.o 		message.o \
	read.o 		rivers.o	structures.o 	time.o utilities.o 	wells.o \
	write.o		unit_impl.o		units_impl.o

$(PROGRAM): $(OBJECTS) 
	$(CC) -o $(PROGRAM) $(OBJECTS) $(LOADFLAGS) 


main.o: main.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) main.c -c

accumulate.o: accumulate.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) accumulate.c -c

check.o: check.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) check.c -c

gpc.o: gpc.c message.h gpc.h 
	$(CC) $(CCFLAGS) gpc.c -c

message.o: message.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) message.c -c

read.o: read.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) read.c -c

rivers.o: rivers.c hstinpt.h time.h message.h gpc.h
	$(CC) $(CCFLAGS) rivers.c -c

structures.o: structures.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) structures.c -c

time.o: time.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) time.c -c

utilities.o: utilities.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) utilities.c -c

wells.o: wells.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) wells.c -c

write.o: write.c hstinpt.h inputproto.h message.h time.h
	$(CC) $(CCFLAGS) write.c -c

unit_impl.o: unit_impl.cxx hstinpt.h gpc.h time.h inputproto.h
	$(CC) $(CCFLAGS) unit_impl.cxx -c

units_impl.o: units_impl.cxx hstinpt.h gpc.h time.h inputproto.h
	$(CC) $(CCFLAGS) units_impl.cxx -c


diff: 
	for FILE in $(FILES); do rcsdiff $$FILE ; done

clean:
	rm -f $(PROGRAM) *.o
	echo Removed files generated by srcinput/Makefile."\n"

#ld-option
# Usage: ldflags += $(call ld-option, -Wl$(comma)--hash-style=sysv)
comma=,
ld-option = $(shell if $(CC) $(1) \
              -nostdlib -o /dev/null -xc /dev/null \
              > /dev/null 2>&1 ; then echo "$(1)" ; else echo "$(2)"; fi)
